<!-- filepath: tamana-website/tamana-website/public_html/index3.html -->
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🎧 تمنای دیدار | کتاب صوتی</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
    body { font-family: 'Vazirmatn', sans-serif; }

    /* Glass Base */
    .glass {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(14px) saturate(180%);
      -webkit-backdrop-filter: blur(14px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.25);
      transition: all 0.3s ease;
    }
    .dark .glass { background: rgba(25,25,25,0.7); border: 1px solid rgba(255,255,255,0.1); }

    /* دکمه شروع پخش */
    .play-btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 9px 16px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.85rem;
      background: rgba(255,255,255,0.25);
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 3px 8px rgba(14,165,233,0.25);
      color: #0d9488;
      transition: all 0.3s ease;
    }
    .play-btn:hover { transform: scale(1.05); background: rgba(13,148,136,0.45); color: white; }
    .dark .play-btn { background: rgba(50,50,50,0.6); color: #5eead4; }

    /* کارت ترک‌ها */
    .track-card {
      border-radius: 14px;
      background: rgba(255,255,255,0.35);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: all .3s ease;
    }
    .track-card:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.12); }
    .dark .track-card { background: rgba(40,40,40,0.7); border: 1px solid rgba(255,255,255,0.1); }

    /* دکمه آیکون */
    .btn-icon {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 10px;
      background: rgba(255,255,255,0.3);
      border: 1px solid rgba(255,255,255,0.35);
      color: #0d9488;
      transition: all .3s ease;
    }
    .btn-icon:hover { transform: scale(1.08); background: rgba(13,148,136,0.5); color: white; }
    .dark .btn-icon { background: rgba(50,50,50,0.7); color: #5eead4; }

    /* پلیر مدرن */
    #playerBar {
      background: rgba(255,255,255,0.25);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,0.3);
    }
    .dark #playerBar {
      background: rgba(24, 31, 35, 0.85); /* رنگ تیره با شفافیت ملایم */
      border: 1px solid rgba(94, 234, 212, 0.18); /* مرز فیروزه‌ای ملایم */
      backdrop-filter: blur(16px);
    }

    input[type=range] {
      appearance: none;
      -webkit-appearance: none;
      height: 4px;
      border-radius: 3px;
      background: linear-gradient(90deg, #06b6d4, #0d9488);
      cursor: pointer;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px; height: 12px;
      background: white;
      border: 2px solid #0d9488;
      border-radius: 50%;
    }

    @media (min-width: 768px) {
      #playerBar {
        width: 320px !important;
        padding: 12px 18px !important;
        min-height: 72px;
        border-radius: 18px !important;
      }
      #playerBar .flex.gap-3.items-center.justify-center.mt-1 {
        gap: 10px !important;
        margin-top: 2px !important;
      }
      #playerBar button.btn-icon {
        width: 36px !important;
        height: 36px !important;
        border-radius: 12px !important;
      }
      #playerBar button#mainPlayBtn {
        width: 44px !important;
        height: 44px !important;
      }
      #playerBar svg {
        width: 22px !important;
        height: 22px !important;
      }
      #playerBar #currentTrack {
        font-size: 0.98rem !important;
      }
      #playerBar #timeInfo {
        font-size: 0.82rem !important;
      }
    }
  </style>
  <!-- رنگ نوار جستجو در موبایل -->
  <meta name="theme-color" content="#14b8a6">
</head>
<body class="min-h-screen bg-gradient-to-br from-cyan-50 via-teal-100 to-cyan-200 dark:from-gray-950 dark:via-gray-900 dark:to-black text-gray-900 dark:text-gray-100 transition">

  <!-- Header -->
  <header class="relative text-center pb-6">
    <div class="w-full min-h-[340px] bg-teal-500 dark:bg-teal-800 flex items-center justify-center rounded-b-3xl text-white pt-8 pb-8">
      <div>
        <img src="images/logo.jpg" alt="لوگو" class="mx-auto mb-2 w-48 h-48 rounded-xl object-cover" />
        <h1 class="text-4xl font-extrabold mb-2">تمنای دیدار</h1>
        <p class="text-lg mb-3">شرحی مختصر بر دعای عهد</p>
        <button onclick="playAudio(tracks[0].src, tracks[0].title, tracks[0].id)" class="play-btn mt-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          شروع پخش
        </button>
      </div>
    </div>
    <button id="toggleDark" class="btn-icon absolute top-4 right-4">
      <!-- خورشید -->
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <circle cx="12" cy="12" r="5" stroke-width="2"/>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 1v2m0 18v2m11-11h-2M3 12H1m16.95 6.95l-1.41-1.41M6.46 6.46L5.05 5.05m12.9 0l-1.41 1.41M6.46 17.54l-1.41 1.41"/>
      </svg>
      <!-- ماه -->
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/>
      </svg>
    </button>
  </header>

  <!-- لیست ترک‌ها -->
  <main class="max-w-3xl mx-auto p-6">
    <h2 class="text-2xl font-bold mb-6">🎶 لیست پخش</h2>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-6 track-list pb-32"></div>
  </main>

  <!-- پلیر مدرن -->
  <div id="playerBar" class="fixed bottom-2 left-1/2 -translate-x-1/2 w-[90%] md:w-[280px] glass rounded-3xl p-3 shadow-2xl flex flex-col gap-2 z-50 border border-teal-200 dark:border-teal-900">
    <div class="flex justify-between items-center text-sm font-bold text-teal-700 dark:text-teal-300 mb-1">
      <span id="currentTrack" class="truncate">🎧 هنوز پلی نکردی!</span>
      <span id="timeInfo" class="text-xs font-normal text-gray-500 dark:text-gray-400">۰۰:۰۰ / ۰۰:۰۰</span>
    </div>
    <input id="progressBar" type="range" value="0" class="w-full accent-teal-500 h-1 rounded-full bg-teal-100 dark:bg-gray-700"/>
    <div class="flex gap-3 items-center justify-center mt-1">
      <button onclick="prevTrack()" class="btn-icon glass shadow-lg" style="border-radius:16px; width:44px; height:44px;">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M11 19V5l-9 7zm2-7l9 7V5z"/></svg>
      </button>
      <button onclick="togglePlay()" id="mainPlayBtn" class="btn-icon glass shadow-lg" style="border-radius:16px; width:52px; height:52px;">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      </button>
      <button onclick="nextTrack()" class="btn-icon glass shadow-lg" style="border-radius:16px; width:44px; height:44px;">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M13 5v14l9-7zm-2 7L2 5v14z"/></svg>
      </button>
    </div>
  </div>

  <script>
    // 🔢 تبدیل اعداد به فارسی
    function toPersianDigits(num) {
      return num.toString().replace(/\d/g, d => '۰۱۲۳۴۵۶۷۸۹'[d]);
    }

    const descs = [
      "آغازین", "پیشگفتار", "مقدمه", "فراز اول", "فراز دوم", "فراز سوم", "فراز چهارم",
      "فراز پنجم", "فراز ششم", "فراز هفتم", "فراز هشتم", "فراز نهم", "فراز دهم",
      "فراز یازدهم", "فراز دوازدهم", "گفتار آخر", "دعای عهد"
    ];

    const tracks = Array.from({length: 17}, (_, i) => ({
      id: i + 1,
      title: `بخش ${toPersianDigits(i + 1)}`,
      desc: descs[i],
      src: `audio/audio${i + 1}.mp3`
    }));

    const trackList = document.querySelector(".track-list");
    const audioPlayer = new Audio();
    const currentTrack = document.getElementById("currentTrack");
    const mainPlayBtn = document.getElementById("mainPlayBtn");
    const progressBar = document.getElementById("progressBar");
    const timeInfo = document.getElementById("timeInfo");
    let playingId = null, currentIndex = 0;

    // کارت ترک‌ها
    tracks.forEach((track, i) => {
      document.querySelector('.track-list').innerHTML +=
        `<div class="track-card glass flex flex-col justify-between items-start p-4 rounded-2xl shadow-md relative h-[120px]">
          <div>
            <h3 class="text-base font-bold mb-2">${track.title}</h3>
            <div class="text-sm text-gray-600 dark:text-gray-400">${track.desc}</div>
          </div>
          <button onclick="playAudio('${track.src}', '${track.title}', ${track.id})" id="btn-${track.id}"
            class="btn-icon glass shadow-lg absolute left-4 bottom-4"
            style="border-radius: 16px; width:44px; height:44px; display:flex; align-items:center; justify-content:center;">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
        </div>`;
    });

    function playAudio(src, title, id) {
      if (playingId === id && !audioPlayer.paused) {
        audioPlayer.pause(); updateButtons(false, id); return;
      }
      audioPlayer.src = src; audioPlayer.play();
      currentTrack.textContent = "🎶 در حال پخش: " + title;
      if (playingId) updateButtons(false, playingId);
      updateButtons(true, id); playingId = id; currentIndex = tracks.findIndex(t => t.id === id);
    }

    function updateButtons(isPlaying, id) {
      const btn = document.getElementById("btn-" + id);
      if (btn) btn.innerHTML = isPlaying
        ? `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6zm8-14v14h4V5z"/></svg>`
        : `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>`;
      mainPlayBtn.innerHTML = isPlaying
        ? `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6zm8-14v14h4V5z"/></svg>`
        : `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>`;
    }

    function togglePlay() {
      if (!audioPlayer.src) return;
      if (audioPlayer.paused) { audioPlayer.play(); updateButtons(true, playingId); }
      else { audioPlayer.pause(); updateButtons(false, playingId); }
    }
    function nextTrack() { currentIndex=(currentIndex+1)%tracks.length; const t=tracks[currentIndex]; playAudio(t.src,t.title,t.id); }
    function prevTrack() { currentIndex=(currentIndex-1+tracks.length)%tracks.length; const t=tracks[currentIndex]; playAudio(t.src,t.title,t.id); }

    audioPlayer.addEventListener("ended", nextTrack);
    audioPlayer.addEventListener("timeupdate", ()=> {
      if (audioPlayer.duration) {
        progressBar.value = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        timeInfo.textContent = toPersianDigits(formatTime(audioPlayer.currentTime)) + " / " + toPersianDigits(formatTime(audioPlayer.duration));
      }
    });
    progressBar.addEventListener("input", ()=> {
      if (audioPlayer.duration) audioPlayer.currentTime = (progressBar.value/100)*audioPlayer.duration;
    });

    function formatTime(sec){
      const m = Math.floor(sec/60).toString().padStart(2,"0");
      const s = Math.floor(sec%60).toString().padStart(2,"0");
      return m + ":" + s;
    }

    // حالت شب/روز
    const toggleBtn = document.getElementById("toggleDark");

    // اطمینان از اعمال تم دارک روی کل سایت هنگام بارگذاری
    if (localStorage.getItem("theme") === "dark") {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }

    function updateThemeColor() {
      let themeColorMeta = document.querySelector('meta[name="theme-color"]');
      if (!themeColorMeta) {
        themeColorMeta = document.createElement('meta');
        themeColorMeta.setAttribute('name', 'theme-color');
        document.head.appendChild(themeColorMeta);
      }
      if (document.documentElement.classList.contains("dark")) {
        themeColorMeta.setAttribute("content", "#115e59");
      } else {
        themeColorMeta.setAttribute("content", "#14b8a6");
      }
    }

    // هنگام تغییر تم، رنگ نوار جستجو را هم تغییر بده
    toggleBtn.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      localStorage.setItem(
        "theme",
        document.documentElement.classList.contains("dark") ? "dark" : "light"
      );
      updateThemeColor();
    });

    // هنگام بارگذاری، رنگ را تنظیم کن
    updateThemeColor();

    // موج صوتی متحرک
    // const wavePolyline = document.getElementById("wavePolyline");
    // function animateWave() {
    //   let points = [];
    //   for(let i=0; i<=18; i++) {
    //     let x = i*20;
    //     let y = 9 + Math.sin(Date.now()/400 + i)*4 + Math.random()*2;
    //     points.push(`${x},${y.toFixed(1)}`);
    //   }
    //   wavePolyline.setAttribute("points", points.join(" "));
    //   requestAnimationFrame(animateWave);
    // }
    // animateWave();
  </script>
</body>
</html>